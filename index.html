<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Manager - ระบบจัดการโรงแรม</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="manifest" href="pwa/manifest.json">
  <link rel="stylesheet" href="assets/styles.css">
  <meta name="theme-color" content="#06b6d4">
</head>
<body class="bg-gray-800 text-gray-200">
  <div class="container mx-auto p-2 sm:p-4 md:p-8">
    <header class="text-center mb-6">
      <h1 class="text-3xl sm:text-4xl font-bold text-white">ระบบจัดการโรงแรม</h1>
      <p class="text-sm sm:text-base text-gray-400">บันทึกข้อมูลการเข้าพักและรายจ่ายประจำวัน</p>
    </header>

    <main class="bg-gray-900 shadow-2xl rounded-lg p-3 sm:p-6 md:p-8">
      <div class="flex justify-between items-center mb-3">
        <div class="flex items-center text-xs text-gray-400">
          <span>สถานะ API:</span>
          <span id="api-status" class="ml-1 text-yellow-400">ตรวจสอบ...</span>
          <button id="api-retry-btn" class="ml-2 hidden text-cyan-400 underline hover:text-cyan-300 text-xs">(ลองใหม่)</button>
        </div>
        <button id="themeToggle" class="bg-gray-700 text-white px-3 py-1 rounded">
          <i class="fa fa-moon mr-1"></i>โหมดกลางคืน
        </button>
      </div>

      <div class="mb-6 border-b border-gray-700">
        <nav class="flex flex-nowrap overflow-x-auto space-x-2 sm:space-x-4 hide-scrollbar" aria-label="Tabs">
          <button id="nav-dashboard" class="nav-btn flex-shrink-0 text-white px-3 py-2 font-medium text-sm rounded-md border-b-2 border-cyan-500">
            <i class="fas fa-tachometer-alt mr-1 sm:mr-2"></i>แดชบอร์ด
          </button>
          <button id="nav-status-view" class="nav-btn flex-shrink-0 text-gray-300 hover:text-white px-3 py-2 font-medium text-sm rounded-md border-b-2 border-transparent">
            <i class="fas fa-bed mr-1 sm:mr-2"></i>สถานะห้องพัก
          </button>
          <button id="nav-history-view" class="nav-btn flex-shrink-0 text-gray-300 hover:text-white px-3 py-2 font-medium text-sm rounded-md border-b-2 border-transparent">
            <i class="fas fa-history mr-1 sm:mr-2"></i>ประวัติ
          </button>
          <button id="nav-expense-view" class="nav-btn flex-shrink-0 text-gray-300 hover:text-white px-3 py-2 font-medium text-sm rounded-md border-b-2 border-transparent">
            <i class="fas fa-wallet mr-1 sm:mr-2"></i>รายจ่าย
          </button>
          <button id="nav-report-view" class="nav-btn flex-shrink-0 text-gray-300 hover:text-white px-3 py-2 font-medium text-sm rounded-md border-b-2 border-transparent">
            <i class="fas fa-chart-pie mr-1 sm:mr-2"></i>รายงาน
          </button>
        </nav>
      </div>

      <!-- Dashboard -->
      <div id="dashboard" class="view active">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
          <h2 class="text-xl sm:text-2xl font-semibold text-white mb-3 sm:mb-0">ภาพรวมทั้งหมด</h2>
          <button id="add-booking-btn" class="w-full sm:w-auto bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg">
            <i class="fas fa-user-plus mr-2"></i>เพิ่มบันทึกใหม่
          </button>
        </div>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6">
          <div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xs sm:text-sm font-medium text-gray-400">รายรับรวมทั้งหมด</h3><p id="db-total-income" class="text-lg sm:text-2xl font-bold text-cyan-400">0.00</p></div>
          <div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xs sm:text-sm font-medium text-gray-400">รายจ่ายรวมทั้งหมด</h3><p id="db-total-expense" class="text-lg sm:text-2xl font-bold text-amber-400">0.00</p></div>
          <div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xs sm:text-sm font-medium text-gray-400">ห้องพักที่มีแขก</h3><p id="db-occupied-rooms" class="text-lg sm:text-2xl font-bold text-indigo-400">0</p></div>
          <div class="bg-gray-800 p-4 rounded-lg"><h3 class="text-xs sm:text-sm font-medium text-gray-400">จำนวนเข้าพัก</h3><p id="db-total-bookings" class="text-lg sm:text-2xl font-bold text-green-400">0</p></div>
        </div>
      </div>

      <!-- Status View -->
      <div id="status-view" class="view">
        <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-white">สถานะห้องพักปัจจุบัน</h2>
        <div id="loading-status" class="text-center py-8 hidden"><div class="spinner inline-block"></div><p class="mt-2">กำลังโหลดข้อมูล...</p></div>
        <div id="status-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"></div>
      </div>

      <!-- History View -->
      <div id="history-view" class="view">
        <h2 class="text-xl sm:text-2xl font-semibold mb-6 text-white">ประวัติการเข้าพัก</h2>
        <div class="flex flex-col md:flex-row gap-4 mb-4 p-4 bg-gray-800 rounded-lg">
          <input type="text" id="search-name" placeholder="ค้นหาตามชื่อ" class="w-full bg-gray-700 border-gray-600 rounded-md text-white">
          <input type="month" id="search-month" class="w-full bg-gray-700 border-gray-600 rounded-md text-white">
          <select id="search-room" class="w-full bg-gray-700 border-gray-600 rounded-md text-white"><option value="">ทุกห้อง</option></select>
          <select id="search-status" class="w-full bg-gray-700 border-gray-600 rounded-md text-white">
            <option value="">ทุกสถานะ</option>
            <option value="Checked In">Checked In</option>
            <option value="Checked Out">Checked Out</option>
          </select>
        </div>
        <div id="loading-history" class="text-center py-8 hidden"><div class="spinner inline-block"></div><p class="mt-2">กำลังโหลดข้อมูล...</p></div>
        <div class="overflow-x-auto bg-gray-800 rounded-lg">
          <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-700">
              <tr>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">เช็คอิน</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">ชื่อผู้เข้าพัก</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">ห้อง</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-300 uppercase">ราคารวม</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">สถานะ</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">ไฟล์</th>
              </tr>
            </thead>
            <tbody id="history-table-body" class="divide-y divide-gray-700"></tbody>
          </table>
        </div>
      </div>

      <!-- Expense View -->
      <div id="expense-view" class="view">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
          <h2 class="text-xl sm:text-2xl font-semibold text-white mb-3 sm:mb-0">บันทึกรายจ่ายประจำวัน</h2>
          <button id="add-expense-btn" class="w-full sm:w-auto bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg">
            <i class="fas fa-plus mr-2"></i>เพิ่มรายจ่าย
          </button>
        </div>
        <div class="flex flex-col sm:flex-row gap-4 mb-6 p-4 bg-gray-800 rounded-lg">
          <div class="w-full">
            <label for="expense-date-filter" class="block text-sm font-medium text-gray-400 mb-1">เลือกวันที่</label>
            <input type="date" id="expense-date-filter" class="bg-gray-700 border-gray-600 rounded-md w-full text-white">
          </div>
          <div class="w-full bg-gray-700 p-4 rounded-lg text-center">
            <h3 class="text-base sm:text-lg font-medium text-gray-300">ยอดรวมรายจ่าย</h3>
            <p id="total-expenses" class="text-xl sm:text-2xl font-bold text-amber-400">0.00</p>
          </div>
        </div>
        <div id="loading-expenses" class="text-center py-8 hidden"><div class="spinner inline-block"></div><p class="mt-2">กำลังโหลดข้อมูล...</p></div>
        <div class="overflow-x-auto bg-gray-800 rounded-lg">
          <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-700">
              <tr>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">วันที่</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">รายการ</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-300 uppercase">จำนวนเงิน</th>
                <th class="px-3 py-3 text-center text-xs font-medium text-gray-300 uppercase">จัดการ</th>
              </tr>
            </thead>
            <tbody id="expense-table-body" class="divide-y divide-gray-700"></tbody>
          </table>
        </div>
      </div>

      <!-- Report View -->
      <div id="report-view" class="view">
        <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4">รายงานสรุปผล</h2>
        <div class="mb-6 border-b border-gray-700">
          <nav class="flex space-x-4" aria-label="Report Tabs">
            <button id="report-tab-daily" class="report-tab-btn text-white border-green-500 px-3 py-2 font-medium text-sm rounded-t-md border-b-2">รายวัน</button>
            <button id="report-tab-monthly" class="report-tab-btn text-gray-400 border-transparent hover:text-white px-3 py-2 font-medium text-sm rounded-t-md border-b-2">รายเดือน</button>
            <button id="report-tab-yearly" class="report-tab-btn text-gray-400 border-transparent hover:text-white px-3 py-2 font-medium text-sm rounded-t-md border-b-2">รายปี</button>
          </nav>
        </div>

        <div id="loading-report" class="text-center py-8 hidden"><div class="spinner inline-block"></div><p class="mt-2">กำลังสร้างรายงาน...</p></div>

        <div id="report-daily-content" class="report-tab-content active">
          <div class="flex justify-between items-center mb-4">
            <div></div>
            <div>
              <label for="report-date-filter" class="text-sm font-medium text-gray-400 mr-2">เลือกวันที่:</label>
              <input type="date" id="report-date-filter" class="bg-gray-700 border-gray-600 rounded-md text-white">
            </div>
          </div>
          <div class="flex justify-end mb-4">
            <button id="print-daily-report-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
              <i class="fa fa-print mr-2"></i>พิมพ์รายงานวันนี้
            </button>
          </div>
          <div id="report-summary" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-6 mb-8">
            <div class="bg-gray-800 p-4 rounded-lg text-center"><h3 class="text-sm font-medium text-gray-300">เงินสด</h3><p id="report-total-cash" class="text-xl sm:text-2xl font-bold text-green-400">0.00</p></div>
            <div class="bg-gray-800 p-4 rounded-lg text-center"><h3 class="text-sm font-medium text-gray-300">เงินโอน</h3><p id="report-total-transfer" class="text-xl sm:text-2xl font-bold text-sky-400">0.00</p></div>
            <div class="bg-gray-800 p-4 rounded-lg text-center"><h3 class="text-sm font-medium text-gray-300">รายรับรวม</h3><p id="report-total-income" class="text-xl sm:text-2xl font-bold text-cyan-400">0.00</p></div>
            <div class="bg-gray-800 p-4 rounded-lg text-center"><h3 class="text-sm font-medium text-gray-300">รายจ่ายรวม</h3><p id="report-total-expense" class="text-xl sm:text-2xl font-bold text-amber-400">0.00</p></div>
            <div class="col-span-2 md:col-span-1 lg:col-auto bg-gray-800 p-4 rounded-lg text-center"><h3 class="text-sm font-medium text-gray-300">คงเหลือสุทธิ</h3><p id="report-net-balance" class="text-xl sm:text-2xl font-bold text-white">0.00</p></div>
          </div>
          <h3 class="text-lg sm:text-xl font-semibold mb-4 text-white">รายการเข้าพักประจำวัน</h3>
          <div class="overflow-x-auto bg-gray-800 rounded-lg">
            <table class="min-w-full divide-y divide-gray-700">
              <thead class="bg-gray-700"><tr>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase">ชื่อผู้เข้าพัก</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-300 uppercase">เงินสด</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-300 uppercase">เงินโอน</th>
                <th class="px-3 py-3 text-right text-xs font-medium text-gray-300 uppercase">ราคารวม</th>
              </tr></thead>
              <tbody id="report-table-body" class="divide-y divide-gray-700"></tbody>
            </table>
          </div>
        </div>

        <div id="report-monthly-content" class="report-tab-content">
          <div class="flex justify-end items-center mb-6">
            <label for="report-month-filter" class="text-sm font-medium text-gray-400 mr-2">เลือกเดือน:</label>
            <input type="month" id="report-month-filter" class="bg-gray-700 border-gray-600 rounded-md text-white">
          </div>
          <div class="bg-gray-800 p-4 sm:p-6 rounded-lg">
            <h3 class="text-base sm:text-lg font-medium text-gray-300 mb-4">สรุปรายได้รายเดือน</h3>
            <canvas id="monthlyIncomeChart-report" height="150"></canvas>
          </div>
        </div>

        <div id="report-yearly-content" class="report-tab-content">
          <div class="flex justify-end items-center mb-6">
            <label for="report-year-filter" class="text-sm font-medium text-gray-400 mr-2">เลือกปี:</label>
            <select id="report-year-filter" class="bg-gray-700 border-gray-600 rounded-md text-white"></select>
          </div>
          <div class="bg-gray-800 p-4 sm:p-6 rounded-lg">
            <h3 class="text-base sm:text-lg font-medium text-gray-300 mb-4">สัดส่วนประเภทห้องพัก</h3>
            <div class="mx-auto" style="max-height: 400px; position: relative;">
              <canvas id="roomTypeChart-report" height="220"></canvas>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Booking Modal -->
  <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden transition-opacity">
    <div class="modal-content max-w-2xl mx-auto mt-8 bg-gray-900 rounded-lg p-6 transform transition-all opacity-100">
      <h3 class="text-xl font-semibold text-white mb-4">เพิ่มการเข้าพัก</h3>
      <form id="activity-form">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-gray-400">ชื่อผู้เข้าพัก</label>
            <input type="text" id="guestName" class="w-full bg-gray-800 rounded-md text-white p-2" required>
          </div>
          <div>
            <label class="text-sm text-gray-400">เลขบัตรประชาชน</label>
            <input type="text" id="guestIdCard" maxlength="13" class="w-full bg-gray-800 rounded-md text-white p-2">
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm text-gray-400">ที่อยู่</label>
            <input type="text" id="guestAddress" class="w-full bg-gray-800 rounded-md text-white p-2">
          </div>
          <div>
            <label class="text-sm text-gray-400">เช็คอิน</label>
            <input type="date" id="checkInDate" class="w-full bg-gray-800 rounded-md text-white p-2" required>
          </div>
          <div>
            <label class="text-sm text-gray-400">เช็คเอาท์</label>
            <input type="date" id="checkOutDate" class="w-full bg-gray-800 rounded-md text-white p-2" required>
          </div>
          <div>
            <label class="text-sm text-gray-400">ห้องพัก</label>
            <select id="roomNumber" class="w-full bg-gray-800 rounded-md text-white p-2" required>
              <option value="">-- เลือกห้อง --</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-400">ประเภทห้อง</label>
            <input type="text" id="roomType" class="w-full bg-gray-800 rounded-md text-white p-2" readonly>
          </div>
          <div>
            <label class="text-sm text-gray-400">ราคา/คืน</label>
            <input type="number" id="pricePerNight" class="w-full bg-gray-800 rounded-md text-white p-2" readonly>
          </div>
          <div>
            <label class="text-sm text-gray-400">จำนวนคืน</label>
            <div id="numberOfNights" class="w-full bg-gray-800 rounded-md text-white p-2">0</div>
          </div>
          <div>
            <label class="text-sm text-gray-400">รวม</label>
            <div id="totalPrice" class="w-full bg-gray-800 rounded-md text-cyan-400 p-2">0.00</div>
          </div>
          <div>
            <label class="text-sm text-gray-400">เงินสด</label>
            <input type="number" id="cashAmount" class="w-full bg-gray-800 rounded-md text-white p-2" min="0" value="0">
          </div>
          <div>
            <label class="text-sm text-gray-400">เงินโอน</label>
            <input type="number" id="transferAmount" class="w-full bg-gray-800 rounded-md text-white p-2" min="0" value="0">
          </div>
          <div>
            <label class="text-sm text-gray-400">จำนวนผู้เข้าพัก</label>
            <input type="number" id="numberOfGuests" class="w-full bg-gray-800 rounded-md text-white p-2" min="1" value="1">
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm text-gray-400">หมายเหตุ</label>
            <input type="text" id="remarks" class="w-full bg-gray-800 rounded-md text-white p-2">
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm text-gray-400">แนบไฟล์ (รูป/PDF สูงสุด 3 ไฟล์)</label>
            <input type="file" id="fileInput" accept="image/*,application/pdf" class="w-full bg-gray-800 rounded-md text-white p-2" multiple>
            <div id="file-preview" class="grid grid-cols-3 gap-2 mt-2"></div>
          </div>
        </div>
        <div class="flex justify-between items-center mt-4">
          <div class="text-sm">คงค้างชำระ: <span id="balanceDue" class="font-bold text-red-400">0.00</span> บาท</div>
          <div class="flex items-center space-x-2">
            <span id="status-message" class="text-sm text-gray-400"></span>
            <button type="button" id="cancel-booking-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">ยกเลิก</button>
            <button id="submit-btn" type="submit" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded"><i class="fas fa-save mr-2"></i>บันทึก</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Expense Modal -->
  <div id="expense-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden transition-opacity">
    <div class="modal-content max-w-lg mx-auto mt-16 bg-gray-900 rounded-lg p-6 transform transition-all opacity-100">
      <h3 class="text-xl font-semibold text-white mb-4">บันทึกรายจ่าย</h3>
      <form id="expense-form">
        <div class="grid grid-cols-1 gap-4">
          <div>
            <label class="text-sm text-gray-400">วันที่</label>
            <input type="date" id="expenseDate" class="w-full bg-gray-800 rounded-md text-white p-2" required>
          </div>
          <div>
            <label class="text-sm text-gray-400">รายการ</label>
            <input type="text" id="expenseDescription" class="w-full bg-gray-800 rounded-md text-white p-2" required>
          </div>
          <div>
            <label class="text-sm text-gray-400">หมวดหมู่</label>
            <input type="text" id="expenseCategory" class="w-full bg-gray-800 rounded-md text-white p-2">
          </div>
          <div>
            <label class="text-sm text-gray-400">จำนวนเงิน</label>
            <input type="number" id="expenseAmount" class="w-full bg-gray-800 rounded-md text-white p-2" min="0" step="0.01" required>
          </div>
        </div>
        <div class="flex justify-end items-center mt-4 space-x-2">
          <span id="expense-status-message" class="text-sm text-gray-400"></span>
          <button type="button" id="cancel-expense-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">ยกเลิก</button>
          <button id="expense-submit-btn" type="submit" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded"><i class="fas fa-save mr-2"></i>บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Extend Modal -->
  <div id="extend-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden transition-opacity">
    <div class="modal-content max-w-md mx-auto mt-24 bg-gray-900 rounded-lg p-6 transform transition-all opacity-100">
      <h3 class="text-xl font-semibold text-white mb-4">ขยายเวลาพัก</h3>
      <form id="extend-form">
        <input type="hidden" id="extend-row-number">
        <div>
          <label class="text-sm text-gray-400">เช็คเอาท์ใหม่</label>
          <input type="date" id="extendCheckOutDate" class="w-full bg-gray-800 rounded-md text-white p-2" required>
        </div>
        <div class="flex justify-end items-center mt-4 space-x-2">
          <span id="extend-status-message" class="text-sm text-gray-400"></span>
          <button type="button" id="cancel-extend-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">ยกเลิก</button>
          <button id="extend-submit-btn" type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded"><i class="fas fa-save mr-2"></i>อัปเดต</button>
        </div>
      </form>
    </div>
  </div>

  <!-- CONFIG -->
  <script>
    window.CONFIG = {
      // เติม URL เว็บแอปของคุณ โดยแนบ token ใน query ด้วย
      SCRIPT_URL: "YOUR_APPS_SCRIPT_WEBAPP_URL_HERE?token=YOUR_STATIC_API_TOKEN",
      API_TOKEN: "YOUR_STATIC_API_TOKEN"
    };
  </script>

  <!-- JS -->
  <script src="assets/utils.js"></script>
  <script src="assets/ui.js"></script>
  <script src="assets/bookings.js"></script>
  <script src="assets/expenses.js"></script>
  <script src="assets/reports.js"></script>
  <script src="assets/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('pwa/sw.js').catch(console.error); }
  </script>
</body>
</html>